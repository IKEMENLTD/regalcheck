# 契約書リスクチェッカー - 要件定義書

## 1. サービス概要

**サービス名**: 契約書リスクチェッカー
**目的**: 契約書の一般的な法的リスクを自動検出し、利用者に警告を提供する無料Webサービス
**開発時間**: 1時間で実装可能なMVP

---

## 2. 機能要件

### 2.1 コア機能

#### ファイルアップロード
- **対応形式**: PDF, DOCX, TXT
- **ファイルサイズ制限**: 10MB
- **UI**: ドラッグ&ドロップ対応

#### リスク分析機能
以下の10項目を自動検出:

1. **一方的な解除条項**: 相手方のみが解除可能な条項
2. **損害賠償の上限がない**: 責任範囲が無制限
3. **不明確な支払条件**: 期限、金額の記載漏れ
4. **知的財産権の帰属**: 権利移転の記載漏れ
5. **秘密保持義務の欠如**: NDA条項の不備
6. **有効期間の記載がない**: 契約期間の明記漏れ
7. **管轄裁判所の未記載**: 紛争解決方法の不明確
8. **自動更新条項**: 解約しにくい自動継続
9. **表明保証の過度な内容**: 実現不可能な保証
10. **遅延損害金の設定**: 高額すぎる設定

#### 結果表示
- **リスクレベル**: 高(🔴)/中(🟡)/低(🟢)
- **リスクスコア**: 100点満点で評価
- **改善提案**: 各リスクに対する具体的な推奨事項
- **検出箇所**: 該当する契約書の文言

---

## 3. 非機能要件

### 3.1 パフォーマンス
- ファイルアップロード → 分析完了: **10秒以内**
- 同時利用者: 10人程度を想定

### 3.2 セキュリティ
- アップロードファイルは**分析後即座に削除**
- ユーザー登録不要（**匿名利用可**）
- **HTTPS**での通信
- APIキーは環境変数で管理

### 3.3 UI/UX
- シングルページアプリケーション (SPA)
- レスポンシブデザイン（PC/タブレット/スマホ対応）
- 日本語UI
- ローディング表示

---

## 4. 技術スタック

### フロントエンド
- **Next.js 14** (App Router)
- **TypeScript**
- **Tailwind CSS**
- **shadcn/ui** (UIコンポーネント)

### バックエンド
- **Next.js API Routes**
- **Anthropic Claude API** (文書分析)
- **pdf-parse** (PDF解析)
- **mammoth** (DOCX解析)

### インフラ
- **Vercel** (ホスティング)

---

## 5. 画面構成

### 5.1 メイン画面 (アップロード前)

```
┌───────────────────────────────────────────┐
│         契約書リスクチェッカー            │
│     ～AIが契約書の落とし穴を発見～        │
├───────────────────────────────────────────┤
│                                           │
│     ┌─────────────────────────────┐       │
│     │  📄                          │       │
│     │  ファイルをドロップ          │       │
│     │  またはクリックして選択      │       │
│     │                              │       │
│     │  PDF, DOCX, TXT (最大10MB)  │       │
│     └─────────────────────────────┘       │
│                                           │
├───────────────────────────────────────────┤
│  ✅ 使い方:                               │
│  1. 契約書ファイルをアップロード          │
│  2. AIが自動分析（約10秒）                │
│  3. リスク箇所と改善案を確認              │
│                                           │
│  ⚠️ 免責事項:                             │
│  本サービスは参考情報であり、法的助言では│
│  ありません。重要な契約は専門家に相談を  │
└───────────────────────────────────────────┘
```

### 5.2 結果画面

```
┌───────────────────────────────────────────┐
│  📊 分析結果                              │
│  リスクスコア: 65/100 ⚠️                 │
│  (スコアが低いほどリスクが高い)          │
├───────────────────────────────────────────┤
│  🔴 高リスク (2件)                       │
│  ┌─────────────────────────────────────┐ │
│  │ 損害賠償の上限がない                 │ │
│  │ 該当箇所: 「甲は損害賠償の責任を...」│ │
│  │ 💡 推奨: 「契約金額の〇倍を上限と   │ │
│  │          する」など上限を明記        │ │
│  └─────────────────────────────────────┘ │
│  ┌─────────────────────────────────────┐ │
│  │ 一方的な解除条項                     │ │
│  │ ...                                  │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  🟡 中リスク (3件)                       │
│  ┌─────────────────────────────────────┐ │
│  │ 知的財産権の帰属が不明確             │ │
│  │ ...                                  │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  🟢 低リスク (1件)                       │
│  ┌─────────────────────────────────────┐ │
│  │ 自動更新条項あり                     │ │
│  │ ...                                  │ │
│  └─────────────────────────────────────┘ │
│                                           │
│  [📥 レポートをダウンロード]              │
│  [🔄 新しい契約書を分析]                 │
└───────────────────────────────────────────┘
```

---

## 6. データフロー

```
1. ユーザー: ファイルアップロード
   ↓
2. フロントエンド: ファイルを読み込み、テキスト抽出
   - PDF → pdf-parse
   - DOCX → mammoth
   - TXT → 直接読み込み
   ↓
3. API Route (/api/analyze): テキストをClaude APIに送信
   ↓
4. Claude API: リスク分析（構造化JSON返却）
   ↓
5. フロントエンド: 結果を整形して表示
   ↓
6. システム: アップロードファイルは即座に削除
   (メモリ上で処理、ディスクに保存しない)
```

---

## 7. API設計

### POST /api/analyze

**Request**:
```typescript
{
  "fileContent": string,  // 抽出されたテキスト
  "fileName": string
}
```

**Response**:
```typescript
{
  "score": number,  // 0-100
  "risks": [
    {
      "category": string,  // "損害賠償", "解除条項" など
      "level": "high" | "medium" | "low",
      "title": string,
      "description": string,
      "quote": string,  // 該当箇所の引用
      "suggestion": string  // 改善提案
    }
  ],
  "summary": string  // 総評
}
```

---

## 8. Claude APIプロンプト設計

```typescript
const systemPrompt = `
あなたは契約書の法的リスクを分析する専門家です。
日本の商取引法・民法に基づいて分析を行ってください。

【分析項目】
1. 一方的な解除条項
2. 損害賠償の上限
3. 支払条件の明確性
4. 知的財産権の帰属
5. 秘密保持義務
6. 有効期間の記載
7. 管轄裁判所
8. 自動更新条項
9. 表明保証の妥当性
10. 遅延損害金

【出力形式】
必ずJSON形式で返してください:
{
  "score": 0-100の数値,
  "risks": [
    {
      "category": "項目名",
      "level": "high|medium|low",
      "title": "リスクのタイトル",
      "description": "詳細な説明",
      "quote": "契約書からの該当箇所の引用",
      "suggestion": "具体的な改善提案"
    }
  ],
  "summary": "全体的な総評（2-3文）"
}
`;

const userPrompt = `
以下の契約書を分析してください:

${fileContent}
`;
```

---

## 9. ファイル構成

```
契約書リスクチェッカー001/
├── app/
│   ├── page.tsx              # メイン画面
│   ├── layout.tsx            # レイアウト
│   ├── globals.css           # グローバルCSS
│   └── api/
│       └── analyze/
│           └── route.ts      # 分析API
├── components/
│   ├── FileUploader.tsx      # ファイルアップロード
│   ├── RiskReport.tsx        # 結果表示
│   └── RiskCard.tsx          # リスクカード
├── lib/
│   ├── fileParser.ts         # ファイル解析
│   ├── claudeClient.ts       # Claude API連携
│   └── types.ts              # 型定義
├── public/
│   └── favicon.ico
├── .env.local                # 環境変数
├── package.json
├── tsconfig.json
├── tailwind.config.ts
└── REQUIREMENTS.md           # この要件定義書
```

---

## 10. 開発工数見積もり（1時間）

| 作業内容 | 時間 |
|---------|------|
| Next.jsプロジェクト作成・環境構築 | 5分 |
| UIコンポーネント実装（shadcn/ui） | 15分 |
| ファイル読み込み処理（PDF/DOCX） | 10分 |
| Claude API連携・プロンプト設計 | 20分 |
| 結果表示画面実装 | 10分 |

**合計**: 60分

---

## 11. 環境変数

```env
ANTHROPIC_API_KEY=sk-ant-xxxxx
```

---

## 12. 今後の拡張案（Phase 2以降）

### 短期（1-2週間）
- 📄 契約書テンプレート提供
- 🏢 業種別リスクチェック（IT/不動産/人材等）
- 📧 メール通知機能

### 中期（1-3ヶ月）
- ✍️ 修正案の自動生成
- 👨‍⚖️ 弁護士監修の詳細レポート（有料版）
- 📊 契約書の比較機能（2つの契約書の差分分析）

### 長期（3ヶ月以上）
- 🔐 ユーザー登録・履歴管理
- 🤝 弁護士マッチングサービス
- 📱 モバイルアプリ化

---

## 13. 必須表示事項

### 免責事項
```
⚠️ 重要な免責事項

本サービスは契約書の一般的なリスクを参考情報として提供するものであり、
法的助言や弁護士によるレビューに代わるものではありません。

- 本サービスの分析結果は完全性を保証しません
- 重要な契約については必ず弁護士等の専門家にご相談ください
- 本サービスの利用により生じた損害について、一切の責任を負いません
- アップロードされたファイルは分析後即座に削除されます
```

### プライバシーポリシー
```
当サービスは以下の方針でデータを扱います:
- アップロードファイルはメモリ上で処理し、保存しません
- 分析のためClaude APIにテキストを送信します
- 個人情報は収集・保存しません
```

---

## 14. 成功指標（KPI）

- **利用者数**: 月間100人
- **分析完了率**: 90%以上
- **平均分析時間**: 10秒以内
- **再訪問率**: 30%以上

---

## 15. リスク・課題

| リスク | 対策 |
|--------|------|
| Claude APIコストが高額 | 月次利用上限を設定 |
| PDF解析の精度 | サポート形式を明記 |
| 法的責任の所在 | 免責事項を明確に表示 |
| 大量アクセス | Rate Limitingの実装 |

---

**作成日**: 2025-11-10
**バージョン**: 1.0
**想定開発期間**: 1時間（MVP）
